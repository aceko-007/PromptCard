<!DOCTYPE html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; font-src 'self' https://cdnjs.cloudflare.com; img-src 'self' data: file:; connect-src 'self';">
    <title>PromptCard Desktop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- 顶部导航栏 -->
        <header class="top-navbar">
            <div class="navbar-left">
                <div class="app-logo">
                    <i class="fas fa-cards-blank"></i>
                    <span>PromptCard Desktop</span>
                </div>
            </div>
            <div class="navbar-center">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" placeholder="搜索卡片标题、内容、作者、模型、网站..." class="search-input">
                    <button id="clearSearch" class="clear-search-btn" style="display: none;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="navbar-right">
                <button id="createTextCard" class="nav-btn create-text-btn">
                    <i class="fas fa-file-text"></i>
                    <span>文本卡片</span>
                </button>
                <button id="createImageCard" class="nav-btn create-image-btn">
                    <i class="fas fa-image"></i>
                    <span>图片卡片</span>
                </button>
                <button id="settingsBtn" class="nav-btn settings-btn">
                    <i class="fas fa-cog"></i>
                    <span>设置</span>
                </button>
            </div>
        </header>

        <div class="main-container">
            <!-- 左侧边栏 -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3>常用</h3>
                    <ul class="sidebar-menu">
                        <li class="menu-item active" data-category="all">
                            <i class="fas fa-th-large"></i>
                            <span>全部卡片</span>
                            <span class="count-badge" id="allCount">0</span>
                        </li>
                        <li class="menu-item" data-category="recent">
                            <i class="fas fa-clock"></i>
                            <span>最近使用</span>
                            <span class="count-badge" id="recentCount">0</span>
                        </li>
                        <li class="menu-item" data-category="favorites">
                            <i class="fas fa-heart"></i>
                            <span>我的收藏</span>
                            <span class="count-badge" id="favoritesCount">0</span>
                        </li>
                    </ul>
                </div>

                <div class="sidebar-section">
                    <div class="section-header">
                        <h3>分类</h3>
                        <button id="addFolder" class="add-folder-btn">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <ul class="sidebar-menu" id="categoriesMenu">
                        <!-- 预设分类 -->
                        <li class="menu-item category-item" data-category="uncategorized">
                            <i class="fas fa-inbox"></i>
                            <span>未分类</span>
                            <span class="count-badge">0</span>
                        </li>
                        <li class="menu-item category-item" data-category="ai-chat">
                            <i class="fas fa-comments"></i>
                            <span>AI对话</span>
                            <span class="count-badge">0</span>
                        </li>
                        <li class="menu-item category-item" data-category="ai-art">
                            <i class="fas fa-palette"></i>
                            <span>AI绘画</span>
                            <span class="count-badge">0</span>
                        </li>
                        <li class="menu-item category-item" data-category="ai-video">
                            <i class="fas fa-video"></i>
                            <span>AI视频</span>
                            <span class="count-badge">0</span>
                        </li>
                        <li class="menu-item category-item" data-category="ai-coding">
                            <i class="fas fa-code"></i>
                            <span>AI编程</span>
                            <span class="count-badge">0</span>
                        </li>
                        <li class="menu-item category-item" data-category="ai-agent">
                            <i class="fas fa-robot"></i>
                            <span>智能体</span>
                            <span class="count-badge">0</span>
                        </li>
                        <!-- 自定义文件夹将在这里动态添加 -->
                    </ul>
                </div>
            </aside>

            <!-- 主内容区 -->
            <main class="main-content">
                <!-- 标签云模块 -->
                <div class="tags-section">
                    <!-- 模型标签行 -->
                    <div class="tag-row">
                        <div class="tag-label">
                            <i class="fas fa-microchip"></i>
                            <span>模型</span>
                            <button id="manageModels" class="manage-btn">
                                <i class="fas fa-cog"></i>
                            </button>
                        </div>
                        <div class="tag-cloud" id="modelTags">
                            <!-- 模型标签将在这里动态生成 -->
                        </div>
                    </div>

                    <!-- 平台标签行 -->
                    <div class="tag-row">
                        <div class="tag-label">
                            <i class="fas fa-globe"></i>
                            <span>平台</span>
                            <button id="managePlatforms" class="manage-btn">
                                <i class="fas fa-cog"></i>
                            </button>
                        </div>
                        <div class="tag-cloud" id="platformTags">
                            <!-- 平台标签将在这里动态生成 -->
                        </div>
                    </div>
                </div>

                <!-- 卡片显示区域 -->
                <div class="content-section">
                    <div class="content-header">
                        <h2 id="contentTitle">全部卡片</h2>
                        <div class="view-controls">
                            <div class="sort-controls">
                                <div class="sort-dropdown">
                                    <button id="sortButton" class="sort-btn">
                                        <i class="fas fa-sort"></i>
                                        <span id="sortLabel">日期</span>
                                        <i class="fas fa-caret-down"></i>
                                    </button>
                                    <div id="sortDropdownMenu" class="sort-dropdown-menu">
                                        <div class="sort-item" data-sort="date">日期</div>
                                        <div class="sort-item" data-sort="title">标题</div>
                                    </div>
                                </div>
                                <button id="sortOrderBtn" class="sort-order-btn" title="切换排序顺序">
                                    <i class="fas fa-sort-amount-down"></i>
                                </button>
                            </div>
                            <button id="gridView" class="view-btn active">
                                <i class="fas fa-th"></i>
                            </button>                        </div>
                    </div>

                    <div class="cards-container" id="cardsContainer">
                        <!-- 卡片将在这里动态生成 -->
                        <div class="empty-state" id="emptyState">
                            <i class="fas fa-inbox"></i>
                            <h3>暂无卡片</h3>
                            <p>点击顶部按钮创建您的第一张卡片</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 模态框容器 -->
    <div id="modalContainer"></div>

    <!-- 通知容器 -->
    <div id="notificationContainer"></div>

    <!-- 创建文件夹模态框模板 -->
    <template id="createFolderModalTemplate">
        <div class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h3>创建文件夹</h3>
                    <button class="modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="folderName">文件夹名称</label>
                        <input type="text" id="folderName" placeholder="请输入文件夹名称" maxlength="50">
                    </div>
                    <div class="form-group">
                        <label>选择图标</label>
                        <div class="icon-selector">
                            <div class="icon-option active" data-icon="fas fa-folder">
                                <i class="fas fa-folder"></i>
                            </div>
                            <div class="icon-option" data-icon="fas fa-star">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="icon-option" data-icon="fas fa-heart">
                                <i class="fas fa-heart"></i>
                            </div>
                            <div class="icon-option" data-icon="fas fa-bookmark">
                                <i class="fas fa-bookmark"></i>
                            </div>
                            <div class="icon-option" data-icon="fas fa-tag">
                                <i class="fas fa-tag"></i>
                            </div>
                            <div class="icon-option" data-icon="fas fa-lightbulb">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div class="icon-option" data-icon="fas fa-gem">
                                <i class="fas fa-gem"></i>
                            </div>
                            <div class="icon-option" data-icon="fas fa-fire">
                                <i class="fas fa-fire"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary modal-cancel">取消</button>
                    <button class="btn btn-primary modal-confirm">确认</button>
                </div>
            </div>
        </div>
    </template>

    <!-- 重命名文件夹模态框模板 -->
    <template id="renameFolderModalTemplate">
        <div class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h3>重命名文件夹</h3>
                    <button class="modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="newFolderName">文件夹名称</label>
                        <input type="text" id="newFolderName" placeholder="请输入新的文件夹名称" maxlength="50">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary modal-cancel">取消</button>
                    <button class="btn btn-primary modal-confirm">确认</button>
                </div>
            </div>
        </div>
    </template>

    <!-- 标签管理模态框模板 -->
    <template id="tagManagementModalTemplate">
        <div class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="tag-modal-title">管理标签</h3>
                    <button class="modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="tag-management-content">
                        <!-- 现有标签 -->
                        <div class="existing-tags-section">
                            <h4>现有标签</h4>
                            <div class="existing-tags-list">
                                <!-- 动态生成现有标签 -->
                            </div>
                        </div>

                        <!-- 添加新标签 -->
                        <div class="add-tag-section">
                            <h4>添加新标签</h4>
                            <div class="form-group">
                                <label>标签名称</label>
                                <input type="text" id="newTagName" placeholder="请输入标签名称" maxlength="30">
                            </div>
                            <div class="form-group url-group" style="display: none;">
                                <label>网站链接（可选）</label>
                                <input type="url" id="newTagUrl" placeholder="https://example.com">
                            </div>
                            <button class="btn btn-primary add-tag-btn">添加标签</button>
                        </div>

                        <!-- 预设标签 -->
                        <div class="preset-tags-section">
                            <h4>预设标签</h4>
                            <div class="preset-tags-list">
                                <!-- 动态生成预设标签 -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary modal-close">关闭</button>
                </div>
            </div>
        </div>
    </template>

    <!-- 分类选择模态框模板 -->
    <template id="categorySelectModalTemplate">
        <div class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h3>选择分类</h3>
                    <button class="modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="category-list">
                        <!-- 动态生成分类列表 -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary modal-cancel">取消</button>
                </div>
            </div>
        </div>
    </template>

    <!-- 设置模态框模板 -->
    <template id="settingsModalTemplate">
        <div class="modal-overlay">
            <div class="modal large-modal">
                <div class="modal-header">
                    <h3>设置</h3>
                    <button class="modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="settings-content">
                        <!-- 默认分类设置 -->
                        <section class="settings-section">
                            <h4><i class="fas fa-folder-plus"></i> 默认分类设置</h4>
                            <div class="form-group">
                                <label>创建卡片时默认分类</label>
                                <select id="defaultCategory" class="form-select">
                                    <!-- 选项将通过JavaScript动态生成 -->
                                </select>
                                <small class="help-text">选择创建新卡片时默认使用的分类</small>
                            </div>
                        </section>

                        <!-- 图片存储信息 -->
                        <section class="settings-section">
                            <h4><i class="fas fa-image"></i> 图片存储</h4>
                            <div class="form-group">
                                <label>存储方式</label>
                                <div class="path-display">
                                    <span>图片数据直接存储在JSON文件中</span>
                                </div>
                                <small class="help-text">所有图片数据将直接保存在应用数据文件中</small>
                            </div>
                        </section>

                        <!-- 存储信息 -->
                        <section class="settings-section">
                            <h4><i class="fas fa-database"></i> 存储信息</h4>
                            <div class="storage-info">
                                <div class="info-item">
                                    <label>数据目录</label>
                                    <div class="path-display">
                                        <span id="dataDirectory"></span>
                                        <button id="openDataDirectory" class="btn btn-link">
                                            <i class="fas fa-external-link-alt"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="info-item">
                                    <label>卡片截图保存目录</label>
                                    <div class="path-display">
                                        <span id="screenshotDirectory"></span>
                                        <button id="selectScreenshotDirectory" class="btn btn-secondary btn-sm">
                                            <i class="fas fa-folder-open"></i> 选择目录
                                        </button>
                                        <button id="openScreenshotDirectory" class="btn btn-link">
                                            <i class="fas fa-external-link-alt"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="stats-grid">
                                    <div class="stat-item">
                                        <span class="stat-label">卡片数量</span>
                                        <span class="stat-value" id="cardCount">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">图片数量</span>
                                        <span class="stat-value" id="imageCount">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">数据大小</span>
                                        <span class="stat-value" id="dataSize">0 KB</span>
                                    </div>
                                </div>
                                <button id="refreshStats" class="btn btn-secondary">
                                    <i class="fas fa-sync-alt"></i> 刷新统计
                                </button>
                            </div>
                        </section>

                        <!-- 数据管理 -->
                        <section class="settings-section">
                            <h4><i class="fas fa-cog"></i> 数据管理</h4>
                            <div class="data-management">
                                <div class="action-buttons">
                                    <button id="importData" class="btn btn-secondary">
                                        <i class="fas fa-file-import"></i> 导入数据
                                    </button>
                                    <button id="exportData" class="btn btn-secondary">
                                        <i class="fas fa-file-export"></i> 导出数据
                                    </button>
                                    <button id="clearAllData" class="btn btn-danger">
                                        <i class="fas fa-trash-alt"></i> 清空所有数据
                                    </button>
                                </div>
                                <small class="help-text">导入/导出为JSON格式，包含完整的卡片、文件夹和自定义标签数据</small>
                            </div>
                        </section>

                        <!-- 应用信息 -->
                        <section class="settings-section">
                            <h4><i class="fas fa-info-circle"></i> 应用信息</h4>
                            <div class="app-info">
                                <div class="info-item">
                                    <label>版本信息</label>
                                    <span>PromptCard Desktop v<span id="appVersion">1.0.0</span></span>
                                </div>
                                <div class="info-item">
                                    <label>Electron版本</label>
                                    <span id="electronVersion"></span>
                                </div>
                                <div class="info-item">
                                    <label>Node.js版本</label>
                                    <span id="nodeVersion"></span>
                                </div>
                                <div class="info-item">
                                    <label>作者主页</label>
                                    <a href="https://github.com/aceko-007/PromptCard" target="_blank" class="btn-link">
                                        <i class="fab fa-github"></i> GitHub项目主页
                                    </a>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary modal-close">关闭</button>
                </div>
            </div>
        </div>
    </template>

    <!-- 卡片模态框模板 -->
    <template id="cardModalTemplate">
        <div class="modal-overlay">
            <div class="modal large-modal card-modal">
                <div class="modal-header">
                    <h3 class="card-modal-title">创建卡片</h3>
                    <button class="modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="card-form">
                        <!-- 图片区域（仅图片卡片显示） -->
                        <div class="image-section" style="display: none;">
                            <div class="uploaded-images">
                                <!-- 已上传的图片将在这里显示 -->
                            </div>
                            <div class="image-upload-area">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>拖拽图片到此处或点击选择文件</p>
                                <p class="upload-help">支持 JPG, JPEG, PNG, GIF, WebP, BMP 格式</p>
                                <input type="file" id="imageUpload" multiple accept="image/*" style="display: none;">
                            </div>
                        </div>

                        <!-- 基本信息 -->
                        <div class="form-group">
                            <label for="cardTitle">标题</label>
                            <input type="text" id="cardTitle" placeholder="请输入卡片标题" maxlength="100">
                        </div>

                        <div class="form-group">
                            <label for="cardDescription">内容</label>
                            <div class="textarea-container">
                                <textarea id="cardDescription" placeholder="请输入提示词内容" rows="8"></textarea>
                                <button class="copy-btn" title="复制内容">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="cardAuthor">作者</label>
                                <input type="text" id="cardAuthor" placeholder="请输入作者名称" maxlength="50">
                            </div>
                            <div class="form-group">
                                <label>分类</label>
                                <button id="selectCategory" class="category-select-btn">
                                    <span class="category-name">AI对话</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                        </div>

                        <!-- 模型管理 -->
                        <div class="form-group">
                            <label>模型</label>
                            <div class="tags-input-container">
                                <div class="selected-tags" id="selectedModels">
                                    <!-- 已选择的模型标签 -->
                                </div>
                                <div class="tag-input-section">
                                    <input type="text" id="modelInput" placeholder="添加模型">
                                    <button id="addModel" class="add-tag-btn">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="preset-tags" id="presetModels">
                                    <!-- 预设模型标签 -->
                                </div>
                            </div>
                        </div>

                        <!-- 网站管理 -->
                        <div class="form-group">
                            <label>网站</label>
                            <div class="websites-container">
                                <div class="selected-websites" id="selectedWebsites">
                                    <!-- 已选择的网站 -->
                                </div>
                                <div class="website-input-section">
                                    <input type="text" id="websiteNameInput" placeholder="网站名称">
                                    <input type="url" id="websiteUrlInput" placeholder="网站链接">
                                    <button id="addWebsite" class="add-tag-btn">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="preset-websites" id="presetWebsites">
                                    <!-- 预设网站 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary modal-cancel">取消</button>
                    <button class="btn btn-primary modal-save">保存</button>
                </div>
            </div>
        </div>
    </template>

    <!-- 确认对话框模板 -->
    <template id="confirmModalTemplate">
        <div class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h3>确认</h3>
                    <button class="modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p class="confirm-message">确定要执行此操作吗？</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary modal-cancel">取消</button>
                    <button class="btn btn-primary modal-confirm">确认</button>
                </div>
            </div>
        </div>
    </template>

    <!-- 图片下载按钮模板 -->
    <template id="downloadImageTemplate">
        <button class="download-image-btn" id="downloadImageBtn">
            <i class="fas fa-download"></i> 下载图片
        </button>
    </template>

    <script src="script.js"></script>
    <script src="download-image.js"></script>
    <script src="override-validation.js"></script>
</body>
</html>